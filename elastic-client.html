<link rel="import" href="../polymer/polymer.html">
<script src="../elasticsearch/elasticsearch.js"></script>
<script src="../elastic.js/dist/elastic.js"></script>

<!--
A Polymer Element which creates and returns a client connection to an Elasticsearch server.

### Example
```html
<elastic-client 
  config='{"host": "http://localhost:9200"}' 
  client="{{client}}"
  cluster-status="{{my-status}}">
</elastic-client>
```

@demo demo/index.html
-->

<script>

  Polymer({
    is: 'elastic-client',

    properties: {
      /** 
       * (Required)
       *
       * An object that contains the elasticsearch client construction configuration options.
       *
       * Example:  {"host": "http://localhost:9200"}
       *
       * The complete configuration options reference is found in the 
       * Elasticsearch documentation here: 
       * https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/configuration.html#config-options
       *
       * @type {Object}
       */
      config: {
        type: Object,
        observer: '_createEsClient'
      },

      /**
       * (Output)
       *
       * Indicates whether the connection to the Elasticsearch server succeeded or failed.
       *
       * @type {String}
       * @default 'down'
       */
      clusterStatus: {
        type: String,
        value: 'down',
        notify: true
      },

      /**
       * (Output)
       *
       * An instance of elasticsearch.Client.  See https://www.elastic.co/guide/en/elasticsearch/client/javascript-api/current/index.html for elasticsearch.js client API documentation.
       *
       * @type {Object}
       */
      client: {
        type: Object,
        notify: true
      }
    },

    /**
     * Creates the elasticsearch.Client object using the given configuration and sets the "client" property.
     *
     * @param {Object} config
     */
    _createEsClient: function(config) {
      this.client = new elasticsearch.Client(config);
      var self = this;

      this.client.ping({
        requestTimeout: 30000,
        hello: 'elasticsearch'
      })
      .then(function () {
        self.clusterStatus = 'up';
      })
      .catch(function(error) {
        console.error('elasticsearch cluster is down!', error);
      });
    }
  });

</script>
